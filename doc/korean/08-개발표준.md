# EAR 개발표준 문서

## 1. 문서 개요

### 1.1 목적

본 문서는 EAR 시스템 개발 시 개발자가 준수해야 할 코딩 표준, 개발 가이드라인, 개발 프로세스를 정의합니다. 일관된 코드 품질 유지와 유지보수성 향상을 목적으로 합니다.

### 1.2 적용 범위

- **프로젝트**: EAR (ERP AI Powered Request System)
- **적용 대상**: 모든 개발자 및 협력업체 개발자
- **적용 기술**: TypeScript, React, Node.js, Express, SAP HANA

### 1.3 문서 구성

1. 코딩 컨벤션
2. 파일 및 디렉토리 구조
3. 네이밍 규칙
4. Git 사용 규칙
5. 코드 리뷰 프로세스
6. API 개발 표준
7. 데이터베이스 개발 표준
8. 테스트 표준
9. 보안 개발 표준
10. 문서화 표준

## 2. 코딩 컨벤션

### 2.1 TypeScript 코딩 표준

#### 2.1.1 기본 설정

- **TypeScript 버전**: 5.3.3 이상
- **Strict 모드**: 항상 활성화
- **타입 명시**: 모든 함수 파라미터와 반환값에 타입 명시

```typescript
// ✅ 좋은 예
async function getUserById(userId: string): Promise<User | null> {
  // ...
}

// ❌ 나쁜 예
async function getUserById(userId) {
  // ...
}
```

#### 2.1.2 들여쓰기 및 공백

- **들여쓰기**: 2 spaces (탭 사용 금지)
- **줄 끝 공백**: 제거
- **파일 끝**: 빈 줄 1개

```typescript
// ✅ 좋은 예
function example() {
  const value = 10;
  return value;
}

// ❌ 나쁜 예
function example(){
    const value=10;
    return value;
}
```

#### 2.1.3 세미콜론

- **사용**: 모든 문장 끝에 세미콜론 사용

```typescript
// ✅ 좋은 예
const name = 'EAR';
const version = '1.0.0';

// ❌ 나쁜 예
const name = 'EAR'
const version = '1.0.0'
```

#### 2.1.4 문자열

- **기본**: 작은따옴표(`'`) 사용
- **템플릿 리터럴**: 동적 문자열 사용 시 백틱(`` ` ``) 사용

```typescript
// ✅ 좋은 예
const message = 'Hello, World!';
const greeting = `Hello, ${name}!`;

// ❌ 나쁜 예
const message = "Hello, World!";
```

#### 2.1.5 함수 선언

- **화살표 함수**: 콜백 함수, 간단한 함수
- **일반 함수**: 복잡한 로직, 재귀 함수

```typescript
// ✅ 좋은 예
const handleClick = () => {
  console.log('clicked');
};

async function processData(data: Data[]): Promise<Result> {
  // 복잡한 로직
}

// ❌ 나쁜 예
function handleClick() {
  console.log('clicked');
}
```

#### 2.1.6 에러 처리

- **try-catch**: 비동기 작업은 항상 try-catch로 감싸기
- **에러 로깅**: 에러 발생 시 상세 로그 기록
- **에러 타입**: 구체적인 에러 타입 사용

```typescript
// ✅ 좋은 예
try {
  const result = await database.query(sql, params);
  return result;
} catch (error) {
  console.error('Database query failed:', error);
  throw new DatabaseError('Failed to execute query', error);
}

// ❌ 나쁜 예
const result = await database.query(sql, params);
return result;
```

### 2.2 React 코딩 표준

#### 2.2.1 컴포넌트 구조

- **함수형 컴포넌트**: 모든 컴포넌트는 함수형으로 작성
- **Hooks 사용**: 클래스 컴포넌트 대신 Hooks 사용
- **컴포넌트 분리**: 단일 책임 원칙 준수

```typescript
// ✅ 좋은 예
interface UserCardProps {
  user: User;
  onEdit: (user: User) => void;
}

function UserCard({ user, onEdit }: UserCardProps) {
  return (
    <div className="user-card">
      <h3>{user.name}</h3>
      <button onClick={() => onEdit(user)}>Edit</button>
    </div>
  );
}

// ❌ 나쁜 예
class UserCard extends React.Component {
  // ...
}
```

#### 2.2.2 Props 타입 정의

- **인터페이스 사용**: Props는 항상 인터페이스로 정의
- **필수/선택 구분**: `?`로 선택적 props 표시

```typescript
// ✅ 좋은 예
interface ButtonProps {
  label: string;
  onClick: () => void;
  disabled?: boolean;
  variant?: 'primary' | 'secondary';
}

function Button({ label, onClick, disabled = false, variant = 'primary' }: ButtonProps) {
  // ...
}

// ❌ 나쁜 예
function Button(props: any) {
  // ...
}
```

#### 2.2.3 State 관리

- **useState**: 로컬 상태 관리
- **useContext**: 전역 상태 관리
- **상태 초기값**: 항상 명시

```typescript
// ✅ 좋은 예
const [count, setCount] = useState<number>(0);
const [user, setUser] = useState<User | null>(null);

// ❌ 나쁜 예
const [count, setCount] = useState();
```

#### 2.2.4 이벤트 핸들러

- **명명 규칙**: `handle` 접두사 사용
- **타입 정의**: 이벤트 타입 명시

```typescript
// ✅ 좋은 예
const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {
  e.preventDefault();
  // ...
};

const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  setValue(e.target.value);
};

// ❌ 나쁜 예
const onSubmit = (e) => {
  // ...
};
```

### 2.3 Node.js/Express 코딩 표준

#### 2.3.1 라우트 정의

- **라우터 분리**: 기능별로 라우터 파일 분리
- **미들웨어 체이닝**: 관련 미들웨어는 체이닝으로 연결

```typescript
// ✅ 좋은 예
import express from 'express';
import { authenticateToken } from '../middleware/auth';

const router = express.Router();

router.get('/users', authenticateToken, async (req, res) => {
  // ...
});

export default router;

// ❌ 나쁜 예
app.get('/users', async (req, res) => {
  // ...
});
```

#### 2.3.2 비동기 처리

- **async/await**: Promise.then() 대신 async/await 사용
- **에러 처리**: 모든 비동기 함수는 try-catch로 감싸기

```typescript
// ✅ 좋은 예
router.post('/users', async (req, res) => {
  try {
    const user = await createUser(req.body);
    res.json({ success: true, data: user });
  } catch (error) {
    console.error('Error creating user:', error);
    res.status(500).json({ success: false, error: 'Internal server error' });
  }
});

// ❌ 나쁜 예
router.post('/users', (req, res) => {
  createUser(req.body).then(user => {
    res.json(user);
  });
});
```

#### 2.3.3 응답 형식

- **일관된 형식**: 모든 API 응답은 동일한 형식 사용

```typescript
// ✅ 좋은 예
res.json({
  success: true,
  data: result,
  message: 'Operation completed'
});

res.status(400).json({
  success: false,
  error: 'Invalid input',
  code: 'VALIDATION_ERROR'
});

// ❌ 나쁜 예
res.json(result);
res.send('Error');
```

## 3. 파일 및 디렉토리 구조

### 3.1 프로젝트 구조

```
ear-project/
├── server/                 # Backend
│   ├── index.ts           # 서버 진입점
│   ├── routes/            # API 라우트
│   │   ├── auth.ts
│   │   ├── chat.ts
│   │   └── ...
│   ├── middleware/        # 미들웨어
│   │   ├── auth.ts
│   │   └── ipWhitelist.ts
│   ├── utils/             # 유틸리티
│   ├── types/             # 타입 정의
│   ├── db.ts              # 데이터베이스 연결
│   └── schemas-hana.sql   # 데이터베이스 스키마
├── web/                    # Frontend
│   ├── src/
│   │   ├── pages/         # 페이지 컴포넌트
│   │   ├── components/    # 재사용 컴포넌트
│   │   ├── hooks/         # 커스텀 Hooks
│   │   ├── utils/         # 유틸리티
│   │   ├── App.tsx        # 메인 앱
│   │   └── main.tsx       # 진입점
│   └── package.json
└── doc/                    # 문서
    ├── korean/
    └── english/
```

### 3.2 파일 명명 규칙

#### 3.2.1 TypeScript 파일

- **컴포넌트**: PascalCase (예: `UserCard.tsx`)
- **유틸리티**: camelCase (예: `api.ts`, `utils.ts`)
- **타입 정의**: camelCase (예: `types.ts`)
- **상수**: UPPER_SNAKE_CASE (예: `constants.ts`)

#### 3.2.2 디렉토리 명명

- **소문자**: 모든 디렉토리는 소문자 사용
- **하이픈 구분**: 여러 단어는 하이픈으로 구분 (예: `user-management`)

### 3.3 파일 구조 예시

#### 3.3.1 React 컴포넌트

```typescript
// UserCard.tsx
import React, { useState } from 'react';
import './UserCard.css';

interface UserCardProps {
  user: User;
  onEdit: (user: User) => void;
}

export function UserCard({ user, onEdit }: UserCardProps) {
  const [isEditing, setIsEditing] = useState(false);

  const handleEdit = () => {
    setIsEditing(true);
  };

  return (
    <div className="user-card">
      {/* 컴포넌트 내용 */}
    </div>
  );
}
```

#### 3.3.2 API 라우트

```typescript
// routes/users.ts
import express from 'express';
import { authenticateToken, requireAdmin } from '../middleware/auth';
import { query } from '../db';

const router = express.Router();

router.get('/', authenticateToken, requireAdmin, async (req, res) => {
  try {
    const users = await query('SELECT * FROM users');
    res.json({ success: true, data: users });
  } catch (error) {
    res.status(500).json({ success: false, error: 'Internal server error' });
  }
});

export default router;
```

## 4. 네이밍 규칙

### 4.1 변수 및 함수

- **camelCase**: 변수, 함수명은 camelCase 사용
- **의미 있는 이름**: 축약어 사용 최소화

```typescript
// ✅ 좋은 예
const userName = 'John';
const userList = [];
function getUserById(id: string) { }

// ❌ 나쁜 예
const un = 'John';
const ul = [];
function getUsr(id: string) { }
```

### 4.2 상수

- **UPPER_SNAKE_CASE**: 상수는 대문자와 언더스코어 사용

```typescript
// ✅ 좋은 예
const MAX_RETRY_COUNT = 3;
const API_BASE_URL = 'https://api.example.com';

// ❌ 나쁜 예
const maxRetryCount = 3;
```

### 4.3 클래스 및 인터페이스

- **PascalCase**: 클래스, 인터페이스, 타입은 PascalCase 사용

```typescript
// ✅ 좋은 예
interface User {
  id: string;
  name: string;
}

class UserService {
  // ...
}

// ❌ 나쁜 예
interface user {
  // ...
}
```

### 4.4 데이터베이스

- **테이블명**: UPPER_SNAKE_CASE (HANA) 또는 snake_case (PostgreSQL)
- **컬럼명**: UPPER_SNAKE_CASE (HANA) 또는 snake_case (PostgreSQL)

```sql
-- HANA
CREATE TABLE EAR.USERS (
  USER_ID NVARCHAR(100),
  USER_NAME NVARCHAR(200)
);

-- PostgreSQL
CREATE TABLE users (
  user_id VARCHAR(100),
  user_name VARCHAR(200)
);
```

## 5. Git 사용 규칙

### 5.1 브랜치 전략

- **main**: 프로덕션 배포용 브랜치
- **develop**: 개발 통합 브랜치
- **feature/**: 기능 개발 브랜치
- **bugfix/**: 버그 수정 브랜치
- **hotfix/**: 긴급 수정 브랜치

```bash
# 브랜치 생성 예시
git checkout -b feature/user-management
git checkout -b bugfix/login-error
git checkout -b hotfix/security-patch
```

### 5.2 커밋 메시지 규칙

- **형식**: `[타입] 간단한 설명`
- **타입**: feat, fix, docs, style, refactor, test, chore

```bash
# ✅ 좋은 예
[feat] 사용자 관리 기능 추가
[fix] 로그인 오류 수정
[docs] API 명세서 업데이트
[refactor] 코드 리팩토링

# ❌ 나쁜 예
수정
update
fix bug
```

### 5.3 커밋 단위

- **원칙**: 하나의 커밋은 하나의 논리적 변경사항만 포함
- **크기**: 작고 의미 있는 단위로 커밋

```bash
# ✅ 좋은 예
[feat] 사용자 등록 API 추가
[feat] 사용자 조회 API 추가

# ❌ 나쁜 예
[feat] 사용자 관리 기능 추가 (등록, 조회, 수정, 삭제 모두 포함)
```

## 6. 코드 리뷰 프로세스

### 6.1 리뷰 기준

- **코드 품질**: 가독성, 유지보수성
- **기능 정확성**: 요구사항 충족 여부
- **성능**: 불필요한 연산, 최적화 여부
- **보안**: 보안 취약점 검토
- **테스트**: 테스트 코드 작성 여부

### 6.2 리뷰 체크리스트

- [ ] 코딩 컨벤션 준수
- [ ] 타입 정의 완료
- [ ] 에러 처리 구현
- [ ] 보안 검토 완료
- [ ] 테스트 코드 작성
- [ ] 문서화 완료
- [ ] 성능 최적화 검토

### 6.3 리뷰 코멘트 작성

- **건설적**: 문제점 지적과 함께 개선 방안 제시
- **명확한**: 구체적인 예시와 함께 설명

```typescript
// 리뷰 코멘트 예시
// 이 부분에서 에러 처리가 없습니다. try-catch로 감싸서 에러를 처리해주세요.
// 예: try { ... } catch (error) { console.error('Error:', error); }
```

## 7. API 개발 표준

### 7.1 RESTful API 설계

- **HTTP 메서드**: GET, POST, PUT, DELETE 적절히 사용
- **URL 구조**: 리소스 중심 설계

```typescript
// ✅ 좋은 예
GET    /api/users          // 사용자 목록 조회
GET    /api/users/:id      // 사용자 상세 조회
POST   /api/users          // 사용자 등록
PUT    /api/users/:id      // 사용자 수정
DELETE /api/users/:id      // 사용자 삭제

// ❌ 나쁜 예
GET /api/getUsers
POST /api/createUser
POST /api/updateUser
POST /api/deleteUser
```

### 7.2 응답 형식

- **성공 응답**: `{ success: true, data: {...} }`
- **에러 응답**: `{ success: false, error: '...', code: '...' }`

```typescript
// ✅ 좋은 예
res.json({
  success: true,
  data: {
    id: 1,
    name: 'John'
  }
});

res.status(400).json({
  success: false,
  error: 'Invalid input',
  code: 'VALIDATION_ERROR'
});

// ❌ 나쁜 예
res.json({ id: 1, name: 'John' });
res.send('Error');
```

### 7.3 인증 및 권한

- **인증**: 모든 API는 인증 미들웨어 적용
- **권한**: 관리자 전용 API는 권한 미들웨어 추가

```typescript
// ✅ 좋은 예
router.get('/users', authenticateToken, async (req, res) => {
  // ...
});

router.delete('/users/:id', authenticateToken, requireAdmin, async (req, res) => {
  // ...
});

// ❌ 나쁜 예
router.get('/users', async (req, res) => {
  // 인증 없이 접근 가능
});
```

### 7.4 입력 검증

- **검증**: 모든 입력 데이터 검증
- **에러 메시지**: 구체적인 에러 메시지 제공

```typescript
// ✅ 좋은 예
router.post('/users', authenticateToken, async (req, res) => {
  const { name, email } = req.body;
  
  if (!name || name.trim().length === 0) {
    return res.status(400).json({
      success: false,
      error: 'Name is required',
      code: 'VALIDATION_ERROR'
    });
  }
  
  if (!email || !isValidEmail(email)) {
    return res.status(400).json({
      success: false,
      error: 'Invalid email format',
      code: 'VALIDATION_ERROR'
    });
  }
  
  // ...
});

// ❌ 나쁜 예
router.post('/users', async (req, res) => {
  const user = await createUser(req.body);
  res.json(user);
});
```

## 8. 데이터베이스 개발 표준

### 8.1 쿼리 작성

- **파라미터화**: SQL Injection 방지를 위해 파라미터화된 쿼리 사용
- **인덱스 활용**: 인덱스가 있는 컬럼 사용

```typescript
// ✅ 좋은 예
const query = 'SELECT * FROM users WHERE user_id = ?';
const result = await db.query(query, [userId]);

// ❌ 나쁜 예
const query = `SELECT * FROM users WHERE user_id = '${userId}'`;
const result = await db.query(query);
```

### 8.2 트랜잭션 처리

- **트랜잭션**: 여러 쿼리가 하나의 작업인 경우 트랜잭션 사용

```typescript
// ✅ 좋은 예
await db.beginTransaction();
try {
  await db.query('INSERT INTO users ...');
  await db.query('INSERT INTO user_roles ...');
  await db.commit();
} catch (error) {
  await db.rollback();
  throw error;
}

// ❌ 나쁜 예
await db.query('INSERT INTO users ...');
await db.query('INSERT INTO user_roles ...');
```

### 8.3 마이그레이션

- **마이그레이션 파일**: 모든 스키마 변경은 마이그레이션 파일로 관리
- **버전 관리**: 마이그레이션 파일은 버전 번호 포함

```sql
-- ✅ 좋은 예
-- migrations/001_add_user_id_to_chat_history.sql
ALTER TABLE EAR.chat_history ADD (USER_ID NVARCHAR(100));
CREATE INDEX idx_chat_user_id ON EAR.chat_history(USER_ID);

-- ❌ 나쁜 예
-- 직접 데이터베이스에서 ALTER TABLE 실행
```

## 9. 테스트 표준

### 9.1 테스트 작성 원칙

- **단위 테스트**: 모든 함수는 단위 테스트 작성
- **통합 테스트**: API 엔드포인트는 통합 테스트 작성
- **커버리지**: 최소 70% 이상 커버리지 목표

### 9.2 테스트 파일 구조

```
server/
├── routes/
│   └── users.ts
└── __tests__/
    └── routes/
        └── users.test.ts
```

### 9.3 테스트 예시

```typescript
// users.test.ts
import request from 'supertest';
import app from '../index';

describe('GET /api/users', () => {
  it('should return user list', async () => {
    const response = await request(app)
      .get('/api/users')
      .set('Authorization', 'Bearer valid-token');
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
    expect(Array.isArray(response.body.data)).toBe(true);
  });
});
```

## 10. 보안 개발 표준

### 10.1 입력 검증

- **모든 입력 검증**: 사용자 입력은 반드시 검증
- **화이트리스트**: 허용된 값만 허용

```typescript
// ✅ 좋은 예
function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

// ❌ 나쁜 예
function validateEmail(email: string): boolean {
  return email.includes('@');
}
```

### 10.2 출력 필터링

- **XSS 방지**: HTML 이스케이프 처리
- **민감 정보 마스킹**: 개인정보 마스킹

```typescript
// ✅ 좋은 예
import DOMPurify from 'isomorphic-dompurify';

const sanitized = DOMPurify.sanitize(userInput);

// ❌ 나쁜 예
const html = `<div>${userInput}</div>`;
```

### 10.3 비밀번호 처리

- **해싱**: 평문 비밀번호 저장 금지
- **bcrypt**: bcrypt로 해싱

```typescript
// ✅ 좋은 예
import bcrypt from 'bcrypt';

const hashedPassword = await bcrypt.hash(password, 10);
const isValid = await bcrypt.compare(password, hashedPassword);

// ❌ 나쁜 예
const hashedPassword = md5(password);
```

## 11. 문서화 표준

### 11.1 코드 주석

- **함수 주석**: 모든 public 함수는 JSDoc 주석 작성
- **복잡한 로직**: 복잡한 로직은 주석으로 설명

```typescript
// ✅ 좋은 예
/**
 * 사용자 ID로 사용자 정보를 조회합니다.
 * @param userId - 조회할 사용자 ID
 * @returns 사용자 정보 또는 null
 */
async function getUserById(userId: string): Promise<User | null> {
  // ...
}

// ❌ 나쁜 예
// 사용자 조회
function getUserById(userId: string) {
  // ...
}
```

### 11.2 README 작성

- **프로젝트 설명**: 프로젝트 개요 및 목적
- **설치 방법**: 환경 설정 및 설치 절차
- **사용 방법**: 기본 사용법 및 예시

### 11.3 API 문서

- **엔드포인트 설명**: 모든 API 엔드포인트 문서화
- **요청/응답 예시**: 실제 예시 포함
- **에러 코드**: 에러 코드 및 메시지 정의

## 12. 개발 환경 설정

### 12.1 필수 도구

- **Node.js**: 18.x 이상
- **npm**: 9.0.0 이상
- **TypeScript**: 5.3.3 이상
- **Git**: 2.30 이상

### 12.2 에디터 설정

- **VS Code / Cursor**: 권장 에디터
- **확장 프로그램**:
  - ESLint
  - Prettier
  - TypeScript and JavaScript Language Features

### 12.3 .editorconfig

```ini
root = true

[*]
charset = utf-8
end_of_line = lf
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
```

## 13. 참고 자료

- TypeScript 공식 문서: https://www.typescriptlang.org/docs/
- React 공식 문서: https://react.dev/
- Express 공식 문서: https://expressjs.com/
- Airbnb JavaScript 스타일 가이드: https://github.com/airbnb/javascript

## 14. 변경 이력

| 버전 | 일자 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-01-XX | 초안 작성 | AI ERP팀 |

