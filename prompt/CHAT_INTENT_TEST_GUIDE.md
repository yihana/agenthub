# 채팅 의도 패턴 테스트 가이드

## 📋 개요

채팅 의도 패턴 기능은 사용자의 채팅 메시지를 분석하여 자동으로 EAR 요청 등록을 유도하는 기능입니다.

## 🚀 초기 데이터 설정

### 방법 1: Node.js 스크립트 실행 (권장)

```bash
# PostgreSQL 사용 시
DB_TYPE=postgres node server/init-chat-intent-data.js

# HANA 사용 시
DB_TYPE=hana node server/init-chat-intent-data.js
```

### 방법 2: SQL 파일 실행

**PostgreSQL:**
```bash
psql -U postgres -d your_database -f server/init-chat-intent-data.sql
```

**HANA DB:**
```sql
-- HANA DB Studio 또는 hdbsql에서 실행
-- server/init-chat-intent-data-hana.sql 파일 사용
-- 
-- 주의: 
-- 1. 개별 INSERT 쿼리로 구성되어 있습니다
-- 2. 중복 실행 시 에러가 발생할 수 있으므로, 이미 데이터가 있는 경우 스킵하세요
-- 3. 또는 Node.js 스크립트 사용을 권장합니다 (자동 중복 체크)
```

### 방법 3: 관리자 페이지에서 직접 추가

1. `/chat-intent-management` 페이지 접속
2. "패턴 추가" 버튼 클릭
3. 패턴 정보 입력 및 저장

## 🧪 테스트 방법

### 테스트 시나리오 1: SAP 로그인 문제

**입력 문구:**
- "SAP 로그인이 안돼"
- "로그인 실패했어요"
- "계정이 잠겼어요"
- "로그인 안됨"
- "접속이 안돼"

**예상 결과:**
- 응답 메시지: "계정이 잠겼을 수 있습니다. 계정 잠금 해제 요청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - 계정 잠금 해제 요청 (EAR 요청 등록)
  - 계정 정보 확인 (사용자 관리 페이지 이동)

### 테스트 시나리오 2: 비밀번호 변경

**입력 문구:**
- "비밀번호 변경하고 싶어요"
- "패스워드 재설정"
- "비밀번호 바꾸고 싶어요"
- "비밀번호 초기화"

**예상 결과:**
- 응답 메시지: "비밀번호 변경이 필요하신가요? 비밀번호 변경 요청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - 비밀번호 변경 요청 (EAR 요청 등록)

### 테스트 시나리오 3: 시스템 접근

**입력 문구:**
- "시스템 접근 권한이 필요해요"
- "시스템 사용하고 싶어요"
- "시스템 로그인 권한"
- "접근 권한 신청"

**예상 결과:**
- 응답 메시지: "시스템 접근 권한이 필요하신가요? 시스템 접근 신청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - 시스템 접근 신청 (EAR 요청 등록)

### 테스트 시나리오 4: 방화벽 오픈

**입력 문구:**
- "방화벽 오픈 신청하고 싶어요"
- "포트 오픈 해주세요"
- "방화벽 허용"
- "네트워크 접근 신청"

**예상 결과:**
- 응답 메시지: "방화벽 오픈가 필요하신가요? 방화벽 오픈 신청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - 방화벽 오픈 신청 (EAR 요청 등록)

### 테스트 시나리오 5: IT 장비 신청

**입력 문구:**
- "IT 장비 신청하려고 해요"
- "노트북 신청"
- "PC 구매하고 싶어요"
- "모니터 신청"

**예상 결과:**
- 응답 메시지: "IT 장비 신청이 필요하신가요? IT 장비 신청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - IT 장비 신청 (EAR 요청 등록)

### 테스트 시나리오 6: 계정 생성

**입력 문구:**
- "계정 생성하고 싶어요"
- "새 계정 만들어주세요"
- "사용자 계정 생성"
- "계정 신청"

**예상 결과:**
- 응답 메시지: "새로운 계정이 필요하신가요? 계정 생성 요청을 진행하시겠습니까?"
- 선택지 모달 표시:
  - 계정 생성 요청 (EAR 요청 등록)

## 📊 데이터 확인

### 데이터베이스에서 직접 확인

```sql
-- 패턴 목록 확인
SELECT id, intent_category, pattern_value, response_message, priority, is_active
FROM chat_intent_patterns
ORDER BY priority DESC;

-- 선택지 확인
SELECT 
  o.id,
  p.intent_category,
  o.option_title,
  o.action_type,
  o.display_order
FROM chat_intent_options o
JOIN chat_intent_patterns p ON o.intent_pattern_id = p.id
ORDER BY p.priority DESC, o.display_order ASC;
```

### 관리자 페이지에서 확인

1. `/chat-intent-management` 접속
2. 패턴 목록 확인
3. 각 패턴을 클릭하여 선택지 확인

## 🔧 패턴 추가/수정

### 관리자 페이지 사용

1. `/chat-intent-management` 접속
2. "패턴 추가" 버튼 클릭
3. 다음 정보 입력:
   - **패턴 타입**: keyword (키워드) 또는 regex (정규식)
   - **패턴 값**: 
     - keyword: 쉼표로 구분된 키워드 목록 (예: "로그인,접속,로그인 안돼")
     - regex: 정규식 패턴 (예: "/로그인.*안돼/i")
   - **응답 메시지**: 사용자에게 표시할 메시지
   - **의도 카테고리**: 패턴 분류 (예: account_lock, password_change)
   - **우선순위**: 숫자가 클수록 먼저 매칭 (기본값: 0)
   - **활성화**: 패턴 사용 여부

4. 선택지 추가:
   - 패턴 저장 후 "선택지 추가" 버튼 클릭
   - 다음 정보 입력:
     - **선택지 제목**: 사용자에게 표시할 제목
     - **선택지 설명**: 선택지에 대한 설명
     - **액션 타입**: 
       - `ear_request`: EAR 요청 등록 페이지로 이동
       - `esm_request`: ESM 요청 등록 페이지로 이동
       - `navigate`: 일반 페이지 이동
     - **액션 데이터**: 
       - EAR/ESM 요청: `{"template_id": 1, "keyword_id": 2}` 형식
       - 페이지 이동: `{"route": "/user-management"}` 형식
     - **아이콘 이름**: Lock, Shield, User, FileText, AlertCircle, Settings, HelpCircle 중 선택
     - **표시 순서**: 숫자가 작을수록 먼저 표시

## 🐛 문제 해결

### 의도가 감지되지 않는 경우

1. **패턴 확인**
   - 관리자 페이지에서 패턴이 활성화되어 있는지 확인
   - 입력한 문구에 패턴의 키워드가 포함되어 있는지 확인

2. **우선순위 확인**
   - 여러 패턴이 매칭될 경우 우선순위가 높은 패턴이 선택됨
   - 우선순위를 조정하여 원하는 패턴이 먼저 매칭되도록 설정

3. **대소문자 구분**
   - 키워드 패턴은 대소문자를 구분하지 않음
   - 정규식 패턴은 설정에 따라 다름

### 선택지가 표시되지 않는 경우

1. **선택지 확인**
   - 관리자 페이지에서 패턴에 선택지가 등록되어 있는지 확인
   - 선택지의 display_order가 올바르게 설정되어 있는지 확인

2. **액션 데이터 확인**
   - JSON 형식이 올바른지 확인
   - 액션 타입과 액션 데이터가 일치하는지 확인

## 📝 참고사항

- 패턴은 우선순위 순으로 매칭됩니다
- 키워드 패턴은 쉼표로 구분된 여러 키워드를 지원합니다
- 정규식 패턴은 더 복잡한 매칭이 필요할 때 사용합니다
- 선택지는 display_order 순으로 표시됩니다
- 관리자만 패턴을 추가/수정/삭제할 수 있습니다

